<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã“ã©ã‚‚å‘ã‘å‹•ç”»</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Helvetica Neue', Arial, 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', Meiryo, sans-serif;
      background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
      min-height: 100vh;
      padding: 10px;
      overflow-x: hidden;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      overflow: hidden;
      position: relative;
    }
    
    /* ãƒ–ãƒ­ãƒƒã‚¯ã‚¿ã‚¤ãƒãƒ¼ï¼ˆç”»é¢å³å´ï¼‰ */
    .block-timer {
      position: fixed;
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
      display: flex;
      flex-direction: column-reverse;
      gap: 8px;
      z-index: 999;
    }
    
    .block {
      width: 60px;
      height: 60px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      transition: all 0.5s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      font-weight: bold;
      color: white;
      position: relative;
    }
    
    .block::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(255,255,255,0.3) 0%, rgba(255,255,255,0) 100%);
      border-radius: 12px;
    }
    
    .block.disappear {
      transform: scale(0) rotate(180deg);
      opacity: 0;
    }
    
    .block.shake {
      animation: shake 0.5s ease;
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-10px) rotate(-5deg); }
      75% { transform: translateX(10px) rotate(5deg); }
    }
    
    /* ã‚«ãƒ©ãƒ•ãƒ«ãªãƒ–ãƒ­ãƒƒã‚¯ã®è‰² */
    .block:nth-child(10n+1) { background: linear-gradient(135deg, #FF6B6B 0%, #C92A2A 100%); }
    .block:nth-child(10n+2) { background: linear-gradient(135deg, #4ECDC4 0%, #1A535C 100%); }
    .block:nth-child(10n+3) { background: linear-gradient(135deg, #FFE66D 0%, #F4A261 100%); }
    .block:nth-child(10n+4) { background: linear-gradient(135deg, #A8DADC 0%, #457B9D 100%); }
    .block:nth-child(10n+5) { background: linear-gradient(135deg, #F08080 0%, #E63946 100%); }
    .block:nth-child(10n+6) { background: linear-gradient(135deg, #98D8C8 0%, #6BCF7F 100%); }
    .block:nth-child(10n+7) { background: linear-gradient(135deg, #FFB6D9 0%, #D946A6 100%); }
    .block:nth-child(10n+8) { background: linear-gradient(135deg, #C4A1FF 0%, #8B5CF6 100%); }
    .block:nth-child(10n+9) { background: linear-gradient(135deg, #FDCB6E 0%, #E17055 100%); }
    .block:nth-child(10n+10) { background: linear-gradient(135deg, #74B9FF 0%, #0984E3 100%); }
    
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 25px;
      text-align: center;
      position: relative;
    }
    
    .header h1 {
      font-size: 48px;
      margin: 0;
    }
    
    /* åºƒå‘Šã‚¹ã‚­ãƒƒãƒ—ãƒœã‚¿ãƒ³ï¼ˆè¦ªç”¨ãƒ»å³ä¸Šï¼‰ */
    .ad-skip-parent {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.5);
      padding: 6px 12px;
      font-size: 11px;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s;
      z-index: 1001;
      opacity: 0.7;
    }
    
    .ad-skip-parent:hover {
      background: rgba(255, 255, 255, 0.3);
      opacity: 1;
    }
    
    .ad-skip-parent:active {
      transform: scale(0.95);
    }
    
    .ad-skip-parent.hidden {
      display: none;
    }
    
    .content {
      padding: 30px;
      padding-right: 100px;
    }
    
    /* å‹•ç”»ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ */
    .video-wrapper {
      position: relative;
      padding-bottom: 56.25%;
      height: 0;
      overflow: hidden;
      border-radius: 20px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.2);
      background: #000;
      margin-bottom: 30px;
    }
    
    .video-wrapper #player {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
    
    /* ç”»é¢ãƒ­ãƒƒã‚¯ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
    .video-block-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: transparent;
      z-index: 100;
      pointer-events: auto;
    }
    
    .video-block-overlay.unlocked {
      pointer-events: none;
    }
    
    /* ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒœã‚¿ãƒ³ */
    .controls {
      display: flex;
      gap: 20px;
      justify-content: center;
      flex-wrap: wrap;
    }
    
    .control-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 35px 70px;
      font-size: 48px;
      font-weight: bold;
      border-radius: 25px;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
      min-width: 220px;
      position: relative;
      overflow: hidden;
    }
    
    .control-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      transition: left 0.5s;
    }
    
    .control-btn:hover::before {
      left: 100%;
    }
    
    .control-btn:active {
      transform: scale(0.95);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
    }
    
    /* åºƒå‘Šé€šçŸ¥ */
    .ad-notice {
      background: linear-gradient(135deg, #fff3cd 0%, #ffe4a3 100%);
      padding: 15px;
      border-radius: 12px;
      text-align: center;
      margin-top: 20px;
      display: none;
      border: 3px solid #ffc107;
    }
    
    .ad-notice.show {
      display: block;
      animation: bounce 0.6s ease;
    }
    
    @keyframes bounce {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    .ad-notice p {
      color: #856404;
      font-weight: bold;
      font-size: 18px;
      margin: 0;
    }
    
    .hidden {
      display: none !important;
    }
    
    /* å®Œäº†ç”»é¢ */
    .completion-screen {
      text-align: center;
      padding: 60px 30px;
      background: linear-gradient(135deg, #e0f7fa 0%, #b2ebf2 100%);
      min-height: 600px;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    
    .completion-screen.show {
      display: flex;
    }
    
    .sleeping-character {
      font-size: 200px;
      margin-bottom: 30px;
      animation: sleep 2s ease-in-out infinite;
    }
    
    @keyframes sleep {
      0%, 100% { transform: translateY(0) rotate(-5deg); }
      50% { transform: translateY(-20px) rotate(5deg); }
    }
    
    .zzz {
      position: absolute;
      font-size: 60px;
      opacity: 0;
      animation: float-zzz 3s ease-in-out infinite;
    }
    
    .zzz:nth-child(1) { left: 35%; animation-delay: 0s; }
    .zzz:nth-child(2) { left: 45%; animation-delay: 1s; }
    .zzz:nth-child(3) { left: 55%; animation-delay: 2s; }
    
    @keyframes float-zzz {
      0% { transform: translateY(0); opacity: 0; }
      50% { opacity: 0.7; }
      100% { transform: translateY(-100px); opacity: 0; }
    }
    
    .completion-screen h2 {
      color: #667eea;
      font-size: 72px;
      margin-bottom: 20px;
    }
    
    /* ã‚¹ãƒãƒ›æ¨ªå‘ãå¯¾å¿œ */
    @media (max-width: 768px) {
      .block-timer {
        right: 5px;
        gap: 5px;
      }
      
      .block {
        width: 45px;
        height: 45px;
        font-size: 20px;
      }
      
      .content {
        padding: 20px;
        padding-right: 60px;
      }
      
      .header h1 {
        font-size: 36px;
      }
      
      .ad-skip-parent {
        font-size: 10px;
        padding: 5px 10px;
      }
      
      .control-btn {
        width: 100%;
        padding: 30px 50px;
        font-size: 36px;
      }
      
      .ad-notice p {
        font-size: 16px;
      }
      
      .sleeping-character {
        font-size: 150px;
      }
      
      .completion-screen h2 {
        font-size: 48px;
      }
    }
    
    /* ã‚¹ãƒãƒ›æ¨ªå‘ãï¼ˆãƒ©ãƒ³ãƒ‰ã‚¹ã‚±ãƒ¼ãƒ—ï¼‰å°‚ç”¨ */
    @media (max-width: 960px) and (orientation: landscape) {
      body {
        padding: 5px;
      }
      
      .container {
        border-radius: 10px;
      }
      
      .header {
        padding: 15px;
      }
      
      .header h1 {
        font-size: 28px;
      }
      
      .content {
        padding: 15px;
        padding-right: 60px;
      }
      
      .video-wrapper {
        margin-bottom: 15px;
      }
      
      .controls {
        gap: 10px;
      }
      
      .control-btn {
        padding: 20px 40px;
        font-size: 32px;
        min-width: 150px;
      }
      
      .block-timer {
        right: 5px;
        gap: 3px;
        max-height: 90vh;
        overflow-y: auto;
      }
      
      .block {
        width: 35px;
        height: 35px;
        font-size: 16px;
      }
      
      .ad-skip-parent {
        font-size: 9px;
        padding: 4px 8px;
      }
      
      .ad-notice {
        padding: 10px;
        margin-top: 10px;
      }
      
      .ad-notice p {
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸˆ</h1>
      <!-- è¦ªç”¨åºƒå‘Šã‚¹ã‚­ãƒƒãƒ—ãƒœã‚¿ãƒ³ï¼ˆå³ä¸Šãƒ»å°ã•ã„ï¼‰ -->
      <button class="ad-skip-parent hidden" id="adSkipParentBtn" onclick="enableAdSkip()">
        ã‚¹ã‚­ãƒƒãƒ—
      </button>
    </div>
    
    <div class="content" id="mainContent">
      <!-- ãƒ–ãƒ­ãƒƒã‚¯ã‚¿ã‚¤ãƒãƒ¼ -->
      <div id="blockTimer" class="block-timer"></div>
      
      <!-- å‹•ç”»ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ -->
      <div class="video-wrapper">
        <div id="player"></div>
        <div id="videoBlockOverlay" class="video-block-overlay"></div>
      </div>
      
      <!-- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒœã‚¿ãƒ³ -->
      <div class="controls">
        <button class="control-btn" id="playBtn" onclick="playVideo()">
          â–¶ï¸
        </button>
        <button class="control-btn hidden" id="pauseBtn" onclick="pauseVideo()">
          â¸ï¸
        </button>
      </div>
      
      <!-- åºƒå‘Šé€šçŸ¥ -->
      <div id="adNotice" class="ad-notice">
        <p>åºƒå‘Šã‚¹ã‚­ãƒƒãƒ—ä¸­ã§ã™ï¼ˆ5ç§’é–“ï¼‰</p>
      </div>
    </div>
    
    <!-- å®Œäº†ç”»é¢ -->
    <div id="completionScreen" class="completion-screen">
      <div style="position: relative; width: 100%;">
        <div class="zzz">ğŸ’¤</div>
        <div class="zzz">ğŸ’¤</div>
        <div class="zzz">ğŸ’¤</div>
        <div class="sleeping-character">ğŸ˜´</div>
      </div>
      <h2>ğŸ‘‹ ã¾ãŸã­ãƒ¼</h2>
    </div>
  </div>
  
  <script>
    let player = null;
    let playerReady = false;
    let currentVideoIndex = 0;
    let startTime = null;
    let timerInterval = null;
    let totalBlocks = 0;
    let currentBlock = 0;
    let adSkipTimeout = null;
    
    // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰è¨­å®šã‚’å–å¾—
    const urlParams = new URLSearchParams(window.location.search);
    const playlistParam = urlParams.get('playlist') || 'dQw4w9WgXcQ';
    const isLooping = urlParams.get('loop') === '1';
    const isAutoplay = urlParams.get('auto') === '1';
    const timeLimit = parseInt(urlParams.get('time') || '0');
    const isLocked = urlParams.get('lock') !== '0';
    
    // ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã‚’è§£æ
    const playlist = playlistParam.split(',').map(id => id.trim());
    
    // YouTube IFrame API ã‚’èª­ã¿è¾¼ã¿
    var tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
    
    function onYouTubeIframeAPIReady() {
      loadVideo(0);
      
      // ç”»é¢ãƒ­ãƒƒã‚¯è¨­å®š
      const overlay = document.getElementById('videoBlockOverlay');
      if (!isLocked) {
        overlay.classList.add('unlocked');
      }
      
      // ãƒ–ãƒ­ãƒƒã‚¯ã‚¿ã‚¤ãƒãƒ¼ã‚’åˆæœŸåŒ–
      if (timeLimit > 0) {
        initBlockTimer();
      }
    }
    
    function initBlockTimer() {
      totalBlocks = timeLimit;
      currentBlock = totalBlocks;
      
      const blockTimer = document.getElementById('blockTimer');
      blockTimer.innerHTML = '';
      
      for (let i = 0; i < totalBlocks; i++) {
        const block = document.createElement('div');
        block.className = 'block';
        block.innerHTML = (i + 1);
        blockTimer.appendChild(block);
      }
    }
    
    function loadVideo(index) {
      currentVideoIndex = index;
      const videoId = playlist[index];
      
      // ã‚¹ã‚­ãƒƒãƒ—ãƒœã‚¿ãƒ³ã‚’å†è¡¨ç¤ºæº–å‚™ï¼ˆæ¬¡ã®å‹•ç”»ç”¨ï¼‰
      document.getElementById('adSkipParentBtn').classList.add('hidden');
      
      if (player) {
        player.loadVideoById(videoId);
      } else {
        player = new YT.Player('player', {
          height: '100%',
          width: '100%',
          videoId: videoId,
          playerVars: {
            'enablejsapi': 1,
            'rel': 0,
            'modestbranding': 1,
            'fs': 0,
            'controls': 1,
            'disablekb': 1,
            'iv_load_policy': 3,
            'showinfo': 0,
            'autoplay': 0
          },
          events: {
            'onReady': onPlayerReady,
            'onStateChange': onPlayerStateChange
          }
        });
      }
    }
    
    function onPlayerReady(event) {
      playerReady = true;
    }
    
    function onPlayerStateChange(event) {
      if (event.data == YT.PlayerState.PLAYING) {
        document.getElementById('playBtn').classList.add('hidden');
        document.getElementById('pauseBtn').classList.remove('hidden');
        
        // åºƒå‘Šã‚¹ã‚­ãƒƒãƒ—ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤ºï¼ˆå†ç”Ÿé–‹å§‹ã‹ã‚‰3ç§’å¾Œï¼‰
        setTimeout(() => {
          document.getElementById('adSkipParentBtn').classList.remove('hidden');
        }, 3000);
        
        if (!startTime && timeLimit > 0) {
          startTime = Date.now();
          startTimer();
        }
      } else if (event.data == YT.PlayerState.PAUSED) {
        document.getElementById('playBtn').classList.remove('hidden');
        document.getElementById('pauseBtn').classList.add('hidden');
      } else if (event.data == YT.PlayerState.ENDED) {
        if (isLooping) {
          player.playVideo();
        } else if (isAutoplay && currentVideoIndex < playlist.length - 1) {
          playNext();
        } else {
          showCompletionScreen();
        }
      }
    }
    
    function playVideo() {
      if (player && playerReady) {
        player.playVideo();
      }
    }
    
    function pauseVideo() {
      if (player && playerReady) {
        player.pauseVideo();
      }
    }
    
    function playNext() {
      currentVideoIndex = (currentVideoIndex + 1) % playlist.length;
      loadVideo(currentVideoIndex);
      if (player && playerReady) {
        player.playVideo();
      }
    }
    
    function enableAdSkip() {
      const overlay = document.getElementById('videoBlockOverlay');
      const notice = document.getElementById('adNotice');
      const btn = document.getElementById('adSkipParentBtn');
      
      // æ—¢å­˜ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’ã‚¯ãƒªã‚¢
      if (adSkipTimeout) {
        clearTimeout(adSkipTimeout);
      }
      
      // ãƒ­ãƒƒã‚¯è§£é™¤
      overlay.classList.add('unlocked');
      notice.classList.add('show');
      btn.disabled = true;
      btn.style.opacity = '0.5';
      
      // 5ç§’å¾Œã«ãƒ­ãƒƒã‚¯å¾©å¸°
      adSkipTimeout = setTimeout(() => {
        // ãƒ­ãƒƒã‚¯è¨­å®šãŒã‚ªãƒ³ã®å ´åˆã®ã¿ãƒ­ãƒƒã‚¯ã‚’æˆ»ã™
        if (isLocked) {
          overlay.classList.remove('unlocked');
        }
        notice.classList.remove('show');
        btn.classList.add('hidden');
        btn.disabled = false;
        btn.style.opacity = '0.7';
        adSkipTimeout = null;
      }, 5000);
    }
    
    function startTimer() {
      if (timeLimit === 0) return;
      
      timerInterval = setInterval(() => {
        removeBlock();
      }, 60000);
    }
    
    function removeBlock() {
      if (currentBlock <= 0) {
        stopTimer();
        if (player && playerReady) {
          player.pauseVideo();
        }
        showCompletionScreen();
        return;
      }
      
      const blocks = document.querySelectorAll('.block');
      const blockToRemove = blocks[currentBlock - 1];
      
      if (blockToRemove) {
        blockToRemove.classList.add('shake');
        
        setTimeout(() => {
          blockToRemove.classList.remove('shake');
          blockToRemove.classList.add('disappear');
        }, 500);
      }
      
      currentBlock--;
    }
    
    function stopTimer() {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
    }
    
    function showCompletionScreen() {
      // åºƒå‘Šã‚¹ã‚­ãƒƒãƒ—ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’ã‚¯ãƒªã‚¢
      if (adSkipTimeout) {
        clearTimeout(adSkipTimeout);
        adSkipTimeout = null;
      }
      
      // å‹•ç”»ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’éè¡¨ç¤º
      document.getElementById('mainContent').classList.add('hidden');
      
      // å®Œäº†ç”»é¢ã‚’è¡¨ç¤º
      document.getElementById('completionScreen').classList.add('show');
    }
  </script>
</body>
</html>
