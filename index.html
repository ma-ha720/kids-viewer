<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>„Åì„Å©„ÇÇÂêë„ÅëÂãïÁîª</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Helvetica Neue', Arial, 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', Meiryo, sans-serif;
      background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      overflow: hidden;
    }
    
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px;
      text-align: center;
    }
    
    .header h1 {
      font-size: 42px;
      margin: 0;
    }
    
    .content {
      padding: 30px;
    }
    
    /* „Çø„Ç§„Éû„ÉºË°®Á§∫ */
    .timer-display {
      background: #fff3cd;
      padding: 20px;
      border-radius: 16px;
      text-align: center;
      font-size: 36px;
      font-weight: bold;
      color: #856404;
      margin-bottom: 30px;
    }
    
    .timer-display.warning {
      background: #f8d7da;
      color: #721c24;
      animation: pulse 1s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
    
    /* ÂãïÁîª„Éó„É¨„Ç§„É§„Éº */
    .video-wrapper {
      position: relative;
      padding-bottom: 56.25%;
      height: 0;
      overflow: hidden;
      border-radius: 16px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.2);
      background: #000;
      margin-bottom: 30px;
    }
    
    .video-wrapper #player {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
    
    /* ÁîªÈù¢„É≠„ÉÉ„ÇØ„Ç™„Éº„Éê„Éº„É¨„Ç§ */
    .video-block-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: transparent;
      z-index: 100;
      pointer-events: auto;
    }
    
    .video-block-overlay.unlocked {
      pointer-events: none;
    }
    
    /* „Ç≥„É≥„Éà„É≠„Éº„É´„Éú„Çø„É≥ */
    .controls {
      display: flex;
      gap: 20px;
      justify-content: center;
      flex-wrap: wrap;
    }
    
    .control-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 30px 60px;
      font-size: 32px;
      font-weight: bold;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
      min-width: 200px;
    }
    
    .control-btn:active {
      transform: scale(0.95);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }
    
    .control-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .control-btn.ad-skip {
      background: linear-gradient(135deg, #ffa726 0%, #fb8c00 100%);
      box-shadow: 0 8px 20px rgba(255, 167, 38, 0.4);
    }
    
    /* Â∫ÉÂëäÈÄöÁü• */
    .ad-notice {
      background: #fff3cd;
      padding: 20px;
      border-radius: 16px;
      text-align: center;
      margin-top: 20px;
      display: none;
    }
    
    .ad-notice.show {
      display: block;
    }
    
    .ad-notice p {
      color: #856404;
      font-weight: bold;
      font-size: 24px;
      margin: 0;
    }
    
    .hidden {
      display: none;
    }
    
    /* ÂÆå‰∫ÜÁîªÈù¢ */
    .completion-screen {
      text-align: center;
      padding: 60px 30px;
    }
    
    .completion-icon {
      font-size: 120px;
      margin-bottom: 30px;
      animation: bounce 1s ease;
    }
    
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-30px); }
    }
    
    .completion-screen h2 {
      color: #667eea;
      font-size: 48px;
      margin-bottom: 20px;
    }
    
    .completion-screen p {
      color: #666;
      font-size: 28px;
      line-height: 1.8;
    }
    
    @media (max-width: 768px) {
      body {
        padding: 10px;
      }
      
      .header h1 {
        font-size: 32px;
      }
      
      .content {
        padding: 20px;
      }
      
      .control-btn {
        width: 100%;
        padding: 25px 40px;
        font-size: 28px;
      }
      
      .timer-display {
        font-size: 28px;
      }
      
      .ad-notice p {
        font-size: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üéà „Å©„ÅÜ„Åå üéà</h1>
    </div>
    
    <div class="content" id="mainContent">
      <!-- „Çø„Ç§„Éû„ÉºË°®Á§∫ -->
      <div id="timerDisplay" class="timer-display hidden">
        „ÅÆ„Åì„Çä: <span id="remainingTime">--:--</span>
      </div>
      
      <!-- ÂãïÁîª„Éó„É¨„Ç§„É§„Éº -->
      <div class="video-wrapper">
        <div id="player"></div>
        <div id="videoBlockOverlay" class="video-block-overlay"></div>
      </div>
      
      <!-- „Ç≥„É≥„Éà„É≠„Éº„É´„Éú„Çø„É≥ -->
      <div class="controls">
        <button class="control-btn" id="playBtn" onclick="playVideo()">
          ‚ñ∂Ô∏è<br>„Åï„ÅÑ„Åõ„ÅÑ
        </button>
        <button class="control-btn hidden" id="pauseBtn" onclick="pauseVideo()">
          ‚è∏Ô∏è<br>„ÅÑ„Å°„Åò„Å¶„ÅÑ„Åó
        </button>
        <button class="control-btn ad-skip hidden" id="adSkipBtn" onclick="enableAdSkip()">
          ‚è≠Ô∏è<br>„Åì„ÅÜ„Åì„Åè<br>„Å®„Å∞„Åô
        </button>
      </div>
      
      <!-- Â∫ÉÂëäÈÄöÁü• -->
      <div id="adNotice" class="ad-notice">
        <p>‚è≥ 10„Å≥„Çá„ÅÜ„Åã„Çì „Åì„ÅÜ„Åì„Åè„Çí„Å®„Å∞„Åõ„Çã„Çà</p>
      </div>
    </div>
    
    <!-- ÂÆå‰∫ÜÁîªÈù¢ -->
    <div id="completionScreen" class="completion-screen hidden">
      <div class="completion-icon">üéâ</div>
      <h2>„Åä„Çè„Å£„Åü„ÇàÔºÅ</h2>
      <p>„Çà„Åè„Åß„Åç„Åæ„Åó„ÅüÔºÅ</p>
    </div>
  </div>
  
  <script>
    let player = null;
    let playerReady = false;
    let currentVideoIndex = 0;
    let startTime = null;
    let timerInterval = null;
    
    // URL„Éë„É©„É°„Éº„Çø„Åã„ÇâË®≠ÂÆö„ÇíÂèñÂæó
    const urlParams = new URLSearchParams(window.location.search);
    const playlistParam = urlParams.get('playlist') || 'dQw4w9WgXcQ';
    const isLooping = urlParams.get('loop') === '1';
    const isAutoplay = urlParams.get('auto') === '1';
    const timeLimit = parseInt(urlParams.get('time') || '0'); // ÂàÜÂçò‰Ωç
    const isLocked = urlParams.get('lock') !== '0'; // „Éá„Éï„Ç©„É´„Éà„Åß„É≠„ÉÉ„ÇØ
    
    // „Éó„É¨„Ç§„É™„Çπ„Éà„ÇíËß£Êûê
    const playlist = playlistParam.split(',').map(id => id.trim());
    
    // YouTube IFrame API „ÇíË™≠„ÅøËæº„Åø
    var tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
    
    function onYouTubeIframeAPIReady() {
      loadVideo(0);
      
      // ÁîªÈù¢„É≠„ÉÉ„ÇØË®≠ÂÆö
      const overlay = document.getElementById('videoBlockOverlay');
      if (!isLocked) {
        overlay.classList.add('unlocked');
      }
      
      // „Çø„Ç§„Éû„ÉºË°®Á§∫
      if (timeLimit > 0) {
        document.getElementById('timerDisplay').classList.remove('hidden');
      }
    }
    
    function loadVideo(index) {
      currentVideoIndex = index;
      const videoId = playlist[index];
      
      if (player) {
        player.loadVideoById(videoId);
      } else {
        player = new YT.Player('player', {
          height: '100%',
          width: '100%',
          videoId: videoId,
          playerVars: {
            'enablejsapi': 1,
            'rel': 0,
            'modestbranding': 1,
            'fs': 0,
            'controls': 1,
            'disablekb': 1,
            'iv_load_policy': 3,
            'showinfo': 0,
            'autoplay': 0
          },
          events: {
            'onReady': onPlayerReady,
            'onStateChange': onPlayerStateChange
          }
        });
      }
    }
    
    function onPlayerReady(event) {
      playerReady = true;
    }
    
    function onPlayerStateChange(event) {
      if (event.data == YT.PlayerState.PLAYING) {
        document.getElementById('playBtn').classList.add('hidden');
        document.getElementById('pauseBtn').classList.remove('hidden');
        
        // Â∫ÉÂëä„Çπ„Ç≠„ÉÉ„Éó„Éú„Çø„É≥„ÇíË°®Á§∫ÔºàÂÜçÁîüÈñãÂßã„Åã„Çâ3ÁßíÂæåÔºâ
        setTimeout(() => {
          document.getElementById('adSkipBtn').classList.remove('hidden');
        }, 3000);
        
        // „Çø„Ç§„Éû„ÉºÈñãÂßã
        if (!startTime && timeLimit > 0) {
          startTime = Date.now();
          startTimer();
        }
      } else if (event.data == YT.PlayerState.PAUSED) {
        document.getElementById('playBtn').classList.remove('hidden');
        document.getElementById('pauseBtn').classList.add('hidden');
      } else if (event.data == YT.PlayerState.ENDED) {
        if (isLooping) {
          player.playVideo();
        } else if (isAutoplay && currentVideoIndex < playlist.length - 1) {
          playNext();
        } else {
          showCompletionScreen();
        }
      }
    }
    
    function playVideo() {
      if (player && playerReady) {
        player.playVideo();
      }
    }
    
    function pauseVideo() {
      if (player && playerReady) {
        player.pauseVideo();
      }
    }
    
    function playNext() {
      currentVideoIndex = (currentVideoIndex + 1) % playlist.length;
      loadVideo(currentVideoIndex);
      if (player && playerReady) {
        player.playVideo();
      }
    }
    
    function enableAdSkip() {
      const overlay = document.getElementById('videoBlockOverlay');
      const notice = document.getElementById('adNotice');
      const btn = document.getElementById('adSkipBtn');
      
      overlay.classList.add('unlocked');
      notice.classList.add('show');
      btn.disabled = true;
      btn.innerHTML = '‚è≥<br>„Åæ„Å£„Å¶<br>„Å¶„Å≠';
      
      setTimeout(() => {
        overlay.classList.remove('unlocked');
        if (isLocked) {
          overlay.style.pointerEvents = 'auto';
        }
        notice.classList.remove('show');
        btn.classList.add('hidden');
        btn.disabled = false;
        btn.innerHTML = '‚è≠Ô∏è<br>„Åì„ÅÜ„Åì„Åè<br>„Å®„Å∞„Åô';
      }, 10000);
    }
    
    function startTimer() {
      if (timeLimit === 0) return;
      
      timerInterval = setInterval(() => {
        updateTimerDisplay();
      }, 1000);
    }
    
    function stopTimer() {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
    }
    
    function updateTimerDisplay() {
      if (!startTime || timeLimit === 0) return;
      
      const elapsed = Math.floor((Date.now() - startTime) / 1000);
      const totalSeconds = timeLimit * 60;
      const remaining = Math.max(0, totalSeconds - elapsed);
      
      const minutes = Math.floor(remaining / 60);
      const seconds = remaining % 60;
      
      const display = document.getElementById('timerDisplay');
      document.getElementById('remainingTime').textContent = 
        `${minutes}:${seconds.toString().padStart(2, '0')}`;
      
      if (remaining <= 60) {
        display.classList.add('warning');
      }
      
      if (remaining === 0) {
        if (player && playerReady) {
          player.pauseVideo();
        }
        stopTimer();
        showCompletionScreen();
      }
    }
    
    function showCompletionScreen() {
      document.getElementById('mainContent').classList.add('hidden');
      document.getElementById('completionScreen').classList.remove('hidden');
    }
  </script>
</body>
</html>
